#! /bin/sh /usr/share/dpatch/dpatch-run
## CVE-2009-0163_tiff_read_overflow.dpatch by Martin Pitt <mpitt@debian.org>
##
## DP: Fix integer overflow induced heap buffer overflow in the
## DP: _cupsImageReadTIFF() function. Discovered by iDefense. [CVE-2009-0163]
@DPATCH@
diff -urNad lenny~/filter/image-private.h lenny/filter/image-private.h
--- lenny~/filter/image-private.h	2007-07-11 14:46:42.000000000 -0700
+++ lenny/filter/image-private.h	2009-04-04 05:54:00.045486999 -0700
@@ -41,8 +41,8 @@
 
 #  define CUPS_IMAGE_MAX_WIDTH	0x07ffffff
 					/* 2^27-1 to allow for 15-channel data */
-#  define CUPS_IMAGE_MAX_HEIGHT	0x7fffffff
-					/* 2^31-1 */
+#  define CUPS_IMAGE_MAX_HEIGHT	0x3fffffff
+					/* 2^30-1 */
 
 #  define CUPS_TILE_SIZE	256	/* 256x256 pixel tiles */
 #  define CUPS_TILE_MINIMUM	10	/* Minimum number of tiles */
