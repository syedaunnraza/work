#! /bin/sh /usr/share/dpatch/dpatch-run
## CVE-2009-0949.dpatch by Nico Golde <nion@debian.org>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: fix null ptr derefence

@DPATCH@
diff -urNad cups-1.3.8~/scheduler/ipp.c cups-1.3.8/scheduler/ipp.c
--- cups-1.3.8~/scheduler/ipp.c	2008-07-21 19:57:20.000000000 +0000
+++ cups-1.3.8/scheduler/ipp.c	2009-05-25 11:16:21.000000000 +0000
@@ -321,7 +321,7 @@
       */
 
       attr = con->request->attrs;
-      if (attr && !strcmp(attr->name, "attributes-charset") &&
+      if (attr && attr->name && !strcmp(attr->name, "attributes-charset") &&
 	  (attr->value_tag & IPP_TAG_MASK) == IPP_TAG_CHARSET)
 	charset = attr;
       else
@@ -330,7 +330,7 @@
       if (attr)
         attr = attr->next;
 
-      if (attr && !strcmp(attr->name, "attributes-natural-language") &&
+      if (attr && attr->name && !strcmp(attr->name, "attributes-natural-language") &&
 	  (attr->value_tag & IPP_TAG_MASK) == IPP_TAG_LANGUAGE)
 	language = attr;
       else
