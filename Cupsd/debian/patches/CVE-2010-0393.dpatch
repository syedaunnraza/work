#! /bin/sh /usr/share/dpatch/dpatch-run
## CVE-2010-0393.dpatch by  <build@>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: do not use environment variables set if running as setuid binary

@DPATCH@
diff -urNad cups-1.3.8~/cups/globals.c cups-1.3.8/cups/globals.c
--- cups-1.3.8~/cups/globals.c	2007-07-11 21:46:42.000000000 +0000
+++ cups-1.3.8/cups/globals.c	2010-03-02 14:04:12.000000000 +0000
@@ -39,6 +39,19 @@
 static void
 cups_env_init(_cups_globals_t *g)	/* I - Global data */
 {
+  if (getuid() != geteuid()) {
+   /*
+    * Running setuid, use default directories...
+    */
+
+    g->cups_datadir    = CUPS_DATADIR;
+    g->cups_serverbin  = CUPS_SERVERBIN;
+    g->cups_serverroot = CUPS_SERVERROOT;
+    g->cups_statedir   = CUPS_STATEDIR;
+    g->localedir       = CUPS_LOCALEDIR;
+    return;
+  }
+
   if ((g->cups_datadir = getenv("CUPS_DATADIR")) == NULL)
     g->cups_datadir = CUPS_DATADIR;
 
