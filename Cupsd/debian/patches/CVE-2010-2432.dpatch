#! /bin/sh /usr/share/dpatch/dpatch-run

@DPATCH@
diff -aur cups-1.3.8.orig/cups/auth.c cups-1.3.8/cups/auth.c
--- cups-1.3.8.orig/cups/auth.c	2008-07-12 00:48:49.000000000 +0200
+++ cups-1.3.8/cups/auth.c	2010-12-08 10:33:41.563950417 +0100
@@ -166,6 +166,15 @@
   else if (http->status == HTTP_UNAUTHORIZED)
     http->digest_tries ++;
 
+    if (http->status == HTTP_UNAUTHORIZED && http->digest_tries >= 3)
+    {
+      DEBUG_printf(("cupsDoAuthentication: too many Negotiate tries (%d)\n",
+                    http->digest_tries));
+  
+      return (-1);
+    }
+
+
  /*
   * Got a password; encode it for the server...
   */
@@ -205,14 +214,6 @@
     }
 #  endif /* __APPLE__ */
 
-    if (http->status == HTTP_UNAUTHORIZED && http->digest_tries >= 3)
-    {
-      DEBUG_printf(("cupsDoAuthentication: too many Negotiate tries (%d)\n",
-                    http->digest_tries));
-  
-      return (-1);
-    }
-
     if (http->gssname == GSS_C_NO_NAME)
     {
       if ((gss_service_name = getenv("CUPS_GSSSERVICENAME")) == NULL)
Nur in cups-1.3.8/cups: auth.c~.
